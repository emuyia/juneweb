{% extends "base.html" %}

{% block content %}

<div class="d-flex mb-1">
    <div class="ms-auto d-flex">
        {% for tag_name in selected_tags %}
            <div class="d-flex m-1">
                <span class="badge bg-primary" style="cursor: pointer;">#{{ tag_name }}</span>
            </div>
        {% endfor %}
        <div class="dropdown ps-1">
          <button class="btn btn-primary dropdown-toggle btn-sm fs-7" type="button" id="tagDropdown" data-bs-toggle="dropdown" aria-expanded="false">Filter</button>
          <ul class="dropdown-menu dropdown-menu-end" id="tag-select" aria-labelledby="tagDropdown">
            {% for tag in tags %}
              {% if tag.name %}
                  <li>
                    <a class="dropdown-item fs-7" id="{{tag.name}}">
                        <input class="form-check-input" type="checkbox" value="{{tag.name}}" {% if tag.name in selected_tags %}checked{% endif %}>
                        <label class="form-check-label">#{{tag.name}}</label>
                    </a>
                  </li>
              {% endif %}
            {% endfor %}
          </ul>
        </div>
    </div>
    <a class="btn btn-secondary btn-sm ms-1" href="{{ url_for('search', q='') }}">Search</a>
</div>

<script>
document.querySelectorAll('.dropdown-item').forEach(item => {
  item.addEventListener('click', function() {
    let selectedTags = window.location.href.split('=')[1] ? window.location.href.split('=')[1].split(',') : [];
    if (selectedTags.includes(this.id)) {
      selectedTags = selectedTags.filter(tag => tag !== this.id);
    } else {
      selectedTags.push(this.id);
    }
    window.location.href = `?tags=${selectedTags.join(',')}`;
  });
});

function filterPostsByTags() {
    let selectedTags = Array.from(document.querySelectorAll('#tag-select input:checked')).map(input => input.value);
    window.location.href = `?tags=${selectedTags.join(',')}`;
}
</script>

<script>
    document.querySelectorAll('.badge').forEach(badge => {
        badge.addEventListener('click', function() {
            let selectedTags = window.location.href.split('=')[1] ? window.location.href.split('=')[1].split(',') : [];
            selectedTags = selectedTags.filter(tag => tag !== this.textContent.slice(1)); // slice(1) to remove the '#' from the badge text
            window.location.href = `?tags=${selectedTags.join(',')}`;
        });
    });
</script>

{% if posts %}
    <div class="row ps-2 pe-2">
        {% for post in posts %}
            {% include 'item_post.html' %}
        {% endfor %}
    </div>
{% else %}
    <p class="ms-5">No posts found.</p>
{% endif %}

{% endblock %}
