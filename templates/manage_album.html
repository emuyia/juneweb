{% extends "manage.html" %}

{% block fields %}
    <input type="text" class="form-control mb-3" name="title" placeholder="Title" value="{{ album.title if album else '' }}">
    <input type="text" class="form-control mb-3" name="artist" placeholder="Artist" value="{{ album.artist if album else '' }}">
    <input type="text" class="form-control mb-3" name="release_date" placeholder="Release Date" value="{{ album.release_date if album else '' }}">
    <input type="text" class="form-control mb-3" name="cover_image" placeholder="Cover Image" value="{{ album.cover_image if album else '' }}">

    <div id="all-tracks">
        {% for track in album.tracks %}
        <div class="card mb-3 track-card">
            <div class="card-body">
                <input type="hidden" name="tracks[][id]" value="{{ track.id }}">
                <input type="text" class="form-control mb-3" name="tracks[][name]" placeholder="Track Name" value="{{ track.name }}">
                <input type="text" class="form-control mb-3" name="tracks[][duration]" placeholder="Track Duration" value="{{ track.duration }}">
                <button type="button" class="btn btn-danger delete-track">Delete Track</button>
            </div>
        </div>
        {% endfor %}
        <div id="tracks-container"></div>
    </div>
    <button type="button" class="btn btn-success mb-3" id="add-track">Add Track</button>
    <script>
    document.getElementById('add-track').addEventListener('click', function() {
        var trackCard = document.createElement('div');
        trackCard.className = 'card mb-3 track-card';
        trackCard.innerHTML = `
            <div class="card-body">
                <input type="hidden" name="tracks[][id]">
                <input type="text" class="form-control mb-3" name="tracks[][name]" placeholder="Track Name">
                <input type="text" class="form-control mb-3" name="tracks[][duration]" placeholder="Track Duration">
                <button class="btn btn-danger delete-track">Delete Track</button>
            </div>
        `;
        document.getElementById('tracks-container').appendChild(trackCard);
    });

    document.getElementById('tracks-container').addEventListener('click', function(e) {
        if (e.target.classList.contains('delete-track')) {
            e.target.parentElement.parentElement.remove();
        }
    });

    document.getElementById('all-tracks').addEventListener('click', function(e) {
        if (e.target.classList.contains('delete-track')) {
            e.target.parentElement.parentElement.remove();
        }
    });
    </script>
{% endblock %}

{% set item_id = album.id %}
{% set item_type = 'album' %}